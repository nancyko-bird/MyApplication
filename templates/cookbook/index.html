{% extends "base.html" %}
{% load static %}
{% block title %}菜谱管理系统{% endblock %}
{% block test-btn %}
    <a href="{% url 'test1' %}" class="btn" rel="noreferrer">
      <!-- Download SVG icon from http://tabler-icons.io/i/brand-github -->
      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" /></svg>
      测试1
    </a>
    <a href="./" class="btn" rel="noreferrer">
      <!-- Download SVG icon from http://tabler-icons.io/i/heart -->
      <svg xmlns="http://www.w3.org/2000/svg" class="icon text-pink" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572" /></svg>
      测试2
    </a>
{% endblock %}
{% block sub_system_name %}
    <a href="{% url 'cbindex' %}">
        <p class="m-0 p-0">>菜谱管理系统</p>
    </a> 
{% endblock %}
{% block page-wrapper %}
        <div class="container-xl opacity-90">
            <div class="row row-cards">
              <div class="col-lg-12"></div>
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">欢迎使用，菜谱管理系统</h3>
                  </div>
                  <div class="card-body border-bottom py-3">
                    <div class="d-flex">
                      <div class="me-2">
                        <form class="row g-3" method="post" action='{% url 'cb_search' %}'>
                            {% csrf_token %}
                            <div class="col-auto">
                                <label for="inputPassword2" class="visually-hidden">Password</label>
                                <input type="text" name="cbname" class="form-control" placeholder="按菜谱搜索">
                            </div>
                            <div class="col-auto">
                                <button type="submit" class="btn btn-primary mb-3">搜索</button>
                            </div>
                        </form>
                      </div>
                      <div class="me-2">
                        <form class="row g-3" method="post" action='{% url 'ing_search' %}'>
                            {% csrf_token %}
                            <div class="col-auto">
                                <label for="inputPassword2" class="visually-hidden">Password</label>
                                <input type="text" name="ingname" class="form-control" placeholder="按食材搜索，用分号分隔">
                            </div>
                            <div class="col-auto">
                                <button type="submit" class="btn btn-primary mb-3">搜索</button>
                            </div>
                        </form>
                      </div>  
                      <div class="ms-auto d-flex">
                          
                          <div class="me-2">
                                <button class="btn btn-primary " data-bs-toggle="modal" data-bs-target="#modal-ingredient">
                                    食材列表
                                </button>
                          </div>
                          <div class="me-2">
                                <button class="btn btn-primary " data-bs-toggle="modal" data-bs-target="#modal-add-ingredient">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M12 5l0 14" />
                                        <path d="M5 12l14 0" />
                                    </svg>
                                    新增食材
                                </button>
                          </div>
                          <div class="">
                                <button class="btn btn-primary " data-bs-toggle="modal" data-bs-target="#modal-add-recipe">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M12 5l0 14" />
                                        <path d="M5 12l14 0" />
                                    </svg>
                                    新增菜谱
                                </button>
                          </div>
                      </div>
                    </div>
                  </div>
                  <div class="table-responsive">
                    <table class="table card-table table-vcenter text-nowrap datatable">
                      <thead>
                        <tr>
                          <th class="w-1">ID</th>
                          <th>菜谱名称</th>
                          <th>材料</th>
                          <th>做法步骤</th>
                          <th>创建时间</th>
                          <th>更新时间</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                          {% for p in page_obj.object_list %}
                            <tr>
                              <td><span class="text-secondary">{{ p.id }}</span></td>
                              <td><a href="./" class="text-reset" tabindex="-1">{{ p.name }}</a></td>
                              <td class="align-middle text-sm">
                                    <p class="font-weight-bold mb-0 max-width-col-100">
                                        {% for t in p.ingredients.all %}
                                            {{ t.name }};
                                        {% endfor %}
                                    </p>
                              </td>  
                              <td>{{ p.steps }}</td>
                              <td>{{ p.created_at }}</td>
                              <td>{{ p.updated_at }}</td>
                              <td class="text-end">
                                <span>  
                                  <a type="button" class="btn align-text-top btn-primary" data-bs-toggle="modal" data-bs-target="#editModal{{ p.id }}">编辑</a>
                                  <a type="button" class="btn align-text-top btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ p.id }}">删除</a>
                                </span>
                              </td>
                            </tr>
                          {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  <div class="card-footer d-flex align-items-center">
                    <ul class="pagination m-0 ms-auto">
                        {% if page_obj.has_previous %}
                          <li class="page-item">
                            <a class="page-link" href="?page=1">首页</a>
                          </li>  
                          <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}" tabindex="-1" aria-disabled="true">
                              上一页</a>
                          </li>
                        {% endif %}
                        {% for pn in page_obj.paginator.page_range %}
                            {% if pn == page_obj.number %}
                                <li class="page-item active">
                                    <a class="page-link" href="?page={{ pn }}">{{ pn }}</a>
                                </li>
                            {% else %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ pn }}">{{ pn }}</a>
                                </li>          
                            {% endif %}
                        {% endfor %}
                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}">下一页</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">尾页</a>
                            </li>
                        {% endif %}
                    </ul>
                  </div>
                </div>
              </div>
            </div>
        </div>
{% endblock %}
{% block other %}
    {#    添加食材记录模态框#}
    <div class="modal modal-blur fade" id="modal-add-ingredient" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">添加食材</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form method="post" action="{% url 'cb_add_ingredient' %}">
              {% csrf_token %}    
            <div class="modal-body">
              <div class="row">
                <div class="col-lg-12">
                  <div class="mb-3">
                    <label class="form-label">食材名称</label>
                    <input type="text" class="form-control" name="ingname">
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <a href="#" class="btn btn-outline-secondary link-secondary" data-bs-dismiss="modal">
                  取消
                </a>
                <button type="submit" class="btn btn-primary ms-auto">
                  <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                      <path d="M12 5l0 14" />
                      <path d="M5 12l14 0" />
                  </svg>
                  添加
                </button>
              </div>
            </div>    
          </form>  
        </div>
      </div>
    </div>
    {#    添加食材模态框 结束#}
    {#    添加菜谱记录模态框#}
    <div class="modal modal-blur fade" id="modal-add-recipe" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">添加记录</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form method="post" action="{% url 'cb_add_record' %}">
              {% csrf_token %}    
            <div class="modal-body">
              <div class="row">
                <div class="col-lg-6">
                  <div class="mb-3">
                    <label class="form-label">菜谱名称</label>
                    <input type="text" class="form-control" name="cbname">
                  </div>
                </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">材料</label>
                      <input type="text" class="form-control" name="cbingredients" placeholder="以分号分隔">
                    </div>  
                  </div>
                  <div class="col-lg-12">
                    <div>
                      <label class="form-label">做法步骤</label>
                      <textarea class="form-control" rows="13" name="cb_steps"></textarea>
                    </div>
                  </div>
                </div>
            </div>
              <div class="modal-footer">
                <a href="#" class="btn btn-outline-secondary link-secondary" data-bs-dismiss="modal">
                  取消
                </a>
                <button type="submit" class="btn btn-primary ms-auto">
                  <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                      <path d="M12 5l0 14" />
                      <path d="M5 12l14 0" />
                  </svg>
                  添加
                </button>
              </div>
          </form>  
        </div>
      </div>
    </div>
    {#    添加记录模态框 结束#}
    {#  食材列表模态框 开始  #}
    <div class="modal modal-blur fade" id="modal-ingredient" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">食材列表</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="tags-list">
                {% for ingredient in ingredients %}
                    <span class="tag">{{ ingredient.name }}</span>
                {% endfor %}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">确定</button>
          </div>
        </div>
      </div>
    </div>
    {#  食材列表 结束  #}
   
    {% for p in page_obj.object_list %}
        {#    编辑记录模态框#}
        <div class="modal modal-blur fade" id="editModal{{ p.id }}" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">修改记录</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <form method="post" action="{% url 'cb_edit_record' cbid=p.id %}">
                  {% csrf_token %}    
                <div class="modal-body">
                  <div class="row">
                      <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label">菜谱名称</label>
                            <input type="text" class="form-control" name="cbname" value="{{ p.name }}">
                        </div>
                      </div>
                      <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">材料</label>
                              <input type="text" class="form-control" name="cbingredients" 
                              value="{% for t in p.ingredients.all %}{{ t.name }};{% endfor %}">
                            </div>  
                      </div>
                      <div class="col-lg-12">
                            <div>
                              <label class="form-label">做法步骤</label>
                              <textarea class="form-control" rows="13" name="cb_steps">{{ p.steps }}</textarea>
                            </div>
                      </div>
                  </div>               
                </div>
                  
                  <div class="modal-footer">
                    <a href="#" class="btn btn-outline-secondary link-secondary" data-bs-dismiss="modal">
                      取消
                    </a>
                    <button type="submit" class="btn btn-primary ms-auto">
                      <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M12 5l0 14" />
                          <path d="M5 12l14 0" />
                      </svg>
                      提交
                    </button>
                  </div>
              </form>  
            </div>
          </div>
        </div>
        {#    编辑记录模态框 结束#}
    {#    确认删除 模态框 开始#}
        <div class="modal fade" id="deleteModal{{ p.id }}" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
            <div class="modal-content">
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              <div class="modal-status bg-danger"></div>
              <div class="modal-body text-center py-4">
                <!-- Download SVG icon from http://tabler-icons.io/i/alert-triangle -->
                <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10.24 3.957l-8.422 14.06a1.989 1.989 0 0 0 1.7 2.983h16.845a1.989 1.989 0 0 0 1.7 -2.983l-8.423 -14.06a1.989 1.989 0 0 0 -3.4 0z" /><path d="M12 9v4" /><path d="M12 17h.01" /></svg>
                <h3>确定要删除记录【{{ p.id }}】吗？</h3>
              </div>
              <div class="modal-footer">
                <div class="w-100">
                  <div class="row">
                    <div class="col"><a href="#" class="btn w-100" data-bs-dismiss="modal">
                        取消
                      </a></div>
                    <div class="col">
                      <a href="{% url 'cb_delete_record' cbid=p.id %}" class="btn btn-danger w-100">确定</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {# 确认删除 模态框 结束#}
    {% endfor %}
{% endblock %}
{% block jsfile %}
{% endblock %}