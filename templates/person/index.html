{% extends "base.html" %}
{% load static %}
{% block title %}个人信息管理系统{% endblock %}
{% block test-btn %}
    <a href="{% url 'test1' %}" class="btn" rel="noreferrer">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" /></svg>
      测试1
    </a>
    <a href="./" class="btn" rel="noreferrer">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon text-pink" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572" /></svg>
      测试2
    </a>
{% endblock %}
{% block sub_system_name %}
    <a href="{% url 'personindex' %}">
        <p class="m-0 p-0">>个人信息管理系统</p>
    </a> 
{% endblock %}
{% block page-wrapper %}
        <div class="container-xl opacity-90">
            <div class="row row-cards">
              <div class="col-lg-12"></div>
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">欢迎使用，个人信息管理系统</h3>
                  </div>
                  <div class="card-body border-bottom py-3">
                    <div class="d-flex">
                      <div class="me-2">
                        <form class="row g-3" method="post" action='{% url 'search' %}'>
                            {% csrf_token %}
                            <div class="col-auto">
                                <label for="inputPassword2" class="visually-hidden">Password</label>
                                <input type="text" name="searchname" class="form-control" placeholder="按姓名搜索">
                            </div>
                            <div class="col-auto">
                                <button type="submit" class="btn btn-primary mb-3">搜索</button>
                            </div>
                        </form>
                      </div>
                      <div class="ms-auto">
                            <button class="btn btn-primary " data-bs-toggle="modal" data-bs-target="#modal-add">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M12 5l0 14" />
                                    <path d="M5 12l14 0" />
                                </svg>
                                新增
                            </button>
                      </div>
                    </div>
                  </div>
                  <div class="table-responsive">
                    <table class="table card-table table-vcenter text-nowrap datatable">
                      <thead>
                        <tr>
                          <th class="w-1">ID</th>
                          <th>姓名</th>
                          <th>身份证号</th>
                          <th>关系</th>
                          <th>手机号</th>
                          <th>现居地</th>
                          <th>备注</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                          {% for p in page_obj.object_list %}
                            <tr>
                              <td><span class="text-secondary">{{ p.id }}</span></td>
                              <td><a href="./" class="text-reset" tabindex="-1">{{ p.name }}</a></td>
                              <td>{{ p.pid }}</td>
                              <td>{{ p.relation }}</td>
                              <td>{{ p.phone }}</td>
                              <td>{{ p.address }}</td>
                              <td>{{ p.notes }}</td>
                              <td class="text-end">
                                <span>
                                  <a type="button" class="btn align-text-top btn-primary" data-bs-toggle="modal" data-bs-target="#detailModal{{ p.id }}">详情</a>
                                  <a type="button" class="btn align-text-top btn-primary" data-bs-toggle="modal" data-bs-target="#editModal{{ p.id }}">编辑</a>
                                  <a type="button" class="btn align-text-top btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ p.id }}">删除</a>
                                </span>
                              </td>
                            </tr>
                          {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  <div class="card-footer d-flex align-items-center">
                    <ul class="pagination m-0 ms-auto">
                        {% if page_obj.has_previous %}
                          <li class="page-item">
                            <a class="page-link" href="?page=1">首页</a>
                          </li>  
                          <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}" tabindex="-1" aria-disabled="true">
                              上一页</a>
                          </li>
                        {% endif %}
                        {% for pn in page_obj.paginator.page_range %}
                            {% if pn == page_obj.number %}
                                <li class="page-item active">
                                    <a class="page-link" href="?page={{ pn }}">{{ pn }}</a>
                                </li>
                            {% else %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ pn }}">{{ pn }}</a>
                                </li>          
                            {% endif %}
                        {% endfor %}
                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}">下一页</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">尾页</a>
                            </li>
                        {% endif %}
                    </ul>
                  </div>
                </div>
              </div>
            </div>
        </div>
{% endblock %}
{% block other %}
    {#    添加记录模态框#}
    <div class="modal modal-blur fade" id="modal-add" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">添加记录</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form method="post" action="{% url 'add_record' %}">
              {% csrf_token %}    
            <div class="modal-body">
              <div class="row">
                <div class="col-lg-6">
                  <div class="mb-3">
                    <label class="form-label">姓名</label>
                    <input type="text" class="form-control" name="person_name">
                  </div>
                </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">身份证号</label>
                      <input type="text" class="form-control" name="person_id">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">性别</label>
{#                      <input type="text" class="form-control" name="person_gender">#}
                      <select class="form-select" name="person_gender">
                        <option value="男">男</option>
                        <option value="女">女</option>
                      </select>  
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">身份</label>
                      <input type="text" class="form-control" name="person_identity">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">出生日期</label>
                      <input type="text" class="form-control" name="person_birth">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">公司</label>
                      <input type="text" class="form-control" name="person_company">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">电话</label>
                      <input type="text" class="form-control" name="person_phone">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">年龄</label>
                      <input type="text" class="form-control" name="person_age">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">籍贯</label>
                      <input type="text" class="form-control" name="person_birth_address">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">现居地</label>
                      <input type="text" class="form-control" name="person_address">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">关系</label>
                      <input type="text" class="form-control" name="person_relation">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">爱好</label>
                      <input type="text" class="form-control" name="person_hobby">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">性格</label>
                      <input type="text" class="form-control" name="person_personality">
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label class="form-label">关联度</label>
                      <input type="text" class="form-control" name="person_correlation_degree">
                    </div>
                  </div>
                  <div class="col-lg-12">
                    <div>
                      <label class="form-label">备注</label>
                      <textarea class="form-control" rows="3" name="person_notes"></textarea>
                    </div>
                  </div>
                </div>
            </div>
              <div class="modal-footer">
                <a href="#" class="btn btn-outline-secondary link-secondary" data-bs-dismiss="modal">
                  取消
                </a>
                <button type="submit" class="btn btn-primary ms-auto">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                      <path d="M12 5l0 14" />
                      <path d="M5 12l14 0" />
                  </svg>
                  添加
                </button>
              </div>
          </form>  
        </div>
      </div>
    </div>
    {#    添加记录模态框 结束#}
    {% for p in page_obj.object_list %}
        {#    编辑记录模态框#}
        <div class="modal modal-blur fade" id="editModal{{ p.id }}" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">修改记录</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <form method="post" action="{% url 'edit_record' personid=p.id %}">
                  {% csrf_token %}    
                  <div class="modal-body">
                      <div class="row">
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">姓名</label>
                              <input type="text" class="form-control" name="person_name" value="{{ p.name }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">身份证号</label>
                              <input type="text" class="form-control" name="person_id" value="{{ p.pid }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">性别</label>
{#                              <input type="text" class="form-control" name="person_gender" value="{{ p.gender }}">#}
                              <select class="form-select" name="person_gender">
                                <option value="男" {% if p.gender == "男" %}selected{% endif %}>男</option>
                                <option value="女" {% if p.gender == "女" %}selected{% endif %}>女</option>
                              </select>    
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">身份</label>
                              <input type="text" class="form-control" name="person_identity" value="{{ p.identity }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">出生日期</label>
                              <input type="text" class="form-control" name="person_birth" value="{{ p.birth }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">公司</label>
                              <input type="text" class="form-control" name="person_company" value="{{ p.company }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">电话</label>
                              <input type="text" class="form-control" name="person_phone" value="{{ p.phone }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">年龄</label>
                              <input type="text" class="form-control" name="person_age" value="{{ p.age }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">籍贯</label>
                              <input type="text" class="form-control" name="person_birth_address" value="{{ p.birth_address }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">现居地</label>
                              <input type="text" class="form-control" name="person_address" value="{{ p.address }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">关系</label>
                              <input type="text" class="form-control" name="person_relation" value="{{ p.relation }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">爱好</label>
                              <input type="text" class="form-control" name="person_hobby" value="{{ p.hobby }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">性格</label>
                              <input type="text" class="form-control" name="person_personality" value="{{ p.personality }}">
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="mb-3">
                              <label class="form-label">关联度</label>
                              <input type="text" class="form-control" name="person_correlation_degree" value="{{ p.correlation_degree }}">
                            </div>
                          </div>
                          <div class="col-lg-12">
                            <div>
                              <label class="form-label">备注</label>
                              <textarea class="form-control" rows="3" name="person_notes">{{ p.notes }}</textarea>
                            </div>
                          </div>
                      </div>
                  </div>                  
                  <div class="modal-footer">
                    <a href="#" class="btn btn-outline-secondary link-secondary" data-bs-dismiss="modal">
                      取消
                    </a>
                    <button type="submit" class="btn btn-primary ms-auto">提交</button>
                  </div>
              </form>  
            </div>
          </div>
        </div>
        {#    编辑记录模态框 结束#}
        {#    查看详情记录模态框#}
        <div class="modal modal-blur fade" id="detailModal{{ p.id }}" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
{#              人物资料卡 #}
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">记录【{{ p.id }}】详细信息</h3>
                  </div>
                  <div class="card-body">
                    <div class="datagrid">
                      <div class="datagrid-item">
                        <div class="datagrid-title">姓名</div>
                        <div class="datagrid-content">{{ p.name }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">身份证号</div>
                        <div class="datagrid-content">{{ p.pid }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">性别</div>
                        <div class="datagrid-content">{{ p.gender }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">电话</div>
                        <div class="datagrid-content">{{ p.phone }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">年龄</div>
                        <div class="datagrid-content">{{ p.age }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">籍贯</div>
                        <div class="datagrid-content">{{ p.birth_address }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">现居地</div>
                        <div class="datagrid-content">{{ p.address }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">出生年月</div>
                        <div class="datagrid-content">{{ p.birth }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">身份</div>
                        <div class="datagrid-content">{{ p.identity }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">关系</div>
                        <div class="datagrid-content">{{ p.relation }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">公司</div>
                        <div class="datagrid-content">{{ p.company }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">爱好</div>
                        <div class="datagrid-content">{{ p.hobby }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">性格</div>
                        <div class="datagrid-content">{{ p.personality }}</div>
                      </div>  
                      <div class="datagrid-item">
                        <div class="datagrid-title">相关度</div>
                        <div class="datagrid-content">{{ p.correlation_degree }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">创建时间</div>
                        <div class="datagrid-content">{{ p.created_at }}</div>
                      </div>
                      <div class="datagrid-item">
                        <div class="datagrid-title">更新时间</div>
                        <div class="datagrid-content">{{ p.updated_at }}</div>
                      </div>  
                      <div class="datagrid-item">
                        <div class="datagrid-title">备注</div>
                        <div class="datagrid-content">
                          {{ p.notes }}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                  <div class="modal-footer">
                    <button class="btn btn-primary ms-auto" data-bs-dismiss="modal">确定</button>
                  </div> 
            </div>
          </div>
        </div>
        {#    查看详情记录模态框 结束#}
    {#    确认删除 模态框 开始#}
        <div class="modal fade" id="deleteModal{{ p.id }}" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
            <div class="modal-content">
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              <div class="modal-status bg-danger"></div>
              <div class="modal-body text-center py-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10.24 3.957l-8.422 14.06a1.989 1.989 0 0 0 1.7 2.983h16.845a1.989 1.989 0 0 0 1.7 -2.983l-8.423 -14.06a1.989 1.989 0 0 0 -3.4 0z" /><path d="M12 9v4" /><path d="M12 17h.01" /></svg>
                <h3>确定要删除记录【{{ p.id }}】吗？</h3>
              </div>
              <div class="modal-footer">
                <div class="w-100">
                  <div class="row">
                    <div class="col"><a href="#" class="btn w-100" data-bs-dismiss="modal">
                        取消
                      </a></div>
                    <div class="col">
                      <a href="{% url 'person_delete_record' personid=p.id %}" class="btn btn-danger w-100">确定</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {# 确认删除 模态框 结束#}
    {% endfor %}
{% endblock %}
